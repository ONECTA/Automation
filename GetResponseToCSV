package AutosysResponse;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Map;

public class GetPayBackDetails {

	public static void main(String[] args) {
		// TODO Auto-generated method stub
GetPayBackDetails gpb = new GetPayBackDetails();
gpb.sendGet();
	}
	private void sendGet() {
		 // The name of the file to open.
        String fileName = "response.xml";

        // This will reference one line at a time
        String line = null;
        String response = "";

        try {
            // FileReader reads text files in the default encoding.
            FileReader fileReader = 
                new FileReader(fileName);

            // Always wrap FileReader in BufferedReader.
            BufferedReader bufferedReader = 
                new BufferedReader(fileReader);

            while((line = bufferedReader.readLine()) != null) {
              //  System.out.println(line);
                if(line.contains("<strData>") && line.contains("</strData>") && line.contains("|")){
                	response = response + "end" + line.split("strData")[1].trim()  + "end" ;
                }
                else if(line.contains("<strData>")  && line.contains("|")){
                	response = response +  "end" + line.split("<strData>")[1].trim();
                }
                else if(line.contains("</strData>") && line.contains("|")){
                	response = response + line.split("</strData>")[0].trim() +  "end" ;
                }
            }   

            // Always close files.
            bufferedReader.close();         
        }
        catch(FileNotFoundException ex) {
            System.out.println(
                "Unable to open file '" + 
                fileName + "'");                
        }
        catch(IOException ex) {
            System.out.println(
                "Error reading file '" 
                + fileName + "'");                  
            // Or we could just do this: 
            // ex.printStackTrace();
        }
    
			
		//Generate the response and extract the status
	    if(response.contains("|")){
	   // System.out.println("Ok response");
	    response =  response.replaceAll("endend", "end").replaceAll("end", "\r\n").replaceAll("[></]", "").replaceAll("[|]",",");
	    System.out.println(response);
	    ResponseWriter(response);
	    }
	    else{
		System.out.println("No data found");
	    }
        
        }
	public void ResponseWriter(String content){
		try {
            //System.out.println("<br>" +sfinalResponse);
			File file = new File("JobResponse.csv");

			// if file doesnt exists, then create it
			if (!file.exists()) {
				file.createNewFile();
			}

			FileWriter fw = new FileWriter(file.getAbsoluteFile());
			BufferedWriter bw = new BufferedWriter(fw);
			bw.write(content);
			bw.close();


		} catch (IOException e) {
			e.printStackTrace();
			System.out.println(e);
			System.out.println("<br>" +"ResponseWriter method failed</font>");
		}
		
	}
  	}

